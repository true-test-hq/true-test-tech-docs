# Resources Module

## Описание
Модуль `Resources` отвечает за загрузку и хранение файлов (изображения, документы).
Поддерживает как публичные, так и приватные ресурсы.

## Основные возможности
-   **Загрузка файлов**:
    -   Загрузка публичных ресурсов (доступны по ссылке).
    -   Загрузка приватных ресурсов (доступны только авторизованным пользователям).
-   **Получение файлов**:
    -   Стриминг файлов по ID.

## Доменные сущности
-   **Resources**: Сущность файла, содержащая имя файла и ключ (путь) в хранилище.

## API
Основные контроллеры:
-   `ResourcesController` (`/api/v1/resources`): Загрузка и скачивание ресурсов.

## Доменные сущности

### Resource (Ресурс)
Файл, загруженный в систему (изображение, документ и т.д.).

**Поля:**
-   `filename`: Имя файла.
-   `link`: Ссылка на скачивание/просмотр файла.

## Архитектура и реализация

### Основные компоненты
-   **ResourcesService**: Сервис уровня приложения.
    -   `uploadPublic`: Загружает файл в публичное хранилище и возвращает прямую ссылку.
    -   `uploadPrivate`: Загружает файл в приватное хранилище, сохраняет метаданные в БД и возвращает ссылку на внутренний API (`/api/v1/resources/:id`).
    -   `getPrivateResource`: Проверяет права доступа (через контроллер) и стримит файл из хранилища.
-   **IResourcesStorageService**: Абстракция над внешним хранилищем (например, S3, MinIO или локальная файловая система).
-   **IResourcesRepository**: Интерфейс для сохранения метаданных приватных ресурсов (связь ID -> Key).

### Команды (Commands)
В данном модуле **не используется** паттерн Command.
Логика загрузки и получения файлов реализована непосредственно в `ResourcesService`.

### Типы ресурсов
-   **Публичные ресурсы**: Доступны по прямой ссылке из хранилища.
-   **Приватные ресурсы**: Доступны только через проксирование бэкендом (стриминг), что позволяет контролировать доступ.

## Для новых разработчиков

### Структура модуля
```
resources/
├── api/                 # Presentation Layer (контроллеры, DTO)
├── infrastructure/     # Infrastructure Layer (реализации интерфейсов)
│   ├── persistence/
│   └── services/
└── model/               # Domain Layer (сущности, сервисы, интерфейсы)
└── index.ts             # Экспорт модуля
```

### Основные потоки данных

1. **Загрузка публичного ресурса**:
   - Контроллер ResourcesController получает файл от клиента
   - ResourcesService загружает файл в публичное хранилище
   - Возвращается прямая ссылка на файл

2. **Загрузка приватного ресурса**:
   - Контроллер ResourcesController получает файл от клиента
   - ResourcesService загружает файл в приватное хранилище
   - Метаданные сохраняются в БД
   - Возвращается ссылка на внутренний API

3. **Получение приватного ресурса**:
   - Контроллер ResourcesController проверяет права доступа
   - ResourcesService стримит файл из хранилища клиенту

### Интеграции с другими модулями

- **Materials**: Для хранения изображений и документов в материалах
- **Accounts**: Для проверки прав доступа к приватным ресурсам

### Важные особенности

- Поддерживаются два типа ресурсов: публичные и приватные
- Публичные ресурсы доступны по прямой ссылке
- Приватные ресурсы доступны только через проксирование бэкендом
- Модуль использует Dependency Injection для подключения зависимостей
- Для работы с внешним хранилищем используется абстракция IResourcesStorageService
