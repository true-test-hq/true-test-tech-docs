# SMTP Module

## Описание
Модуль `SMTP` отвечает за отправку электронных писем.
Является инфраструктурным модулем, используемым другими частями системы для уведомлений.
Для генерации писем используется `Handlebars`

## Основные возможности
-   **Отправка писем**:
    -   Подтверждение регистрации.
    -   Приглашения.
    -   Восстановление пароля.
    -   Произвольные письма по шаблонам.

## Интеграции
-   Использует внешние сервисы (например, Unisender) для доставки писем.

## Архитектура и реализация

### Основные компоненты
-   **SmtpService**: Фасад для отправки писем.
    -   Делегирует отправку специализированным сервисам (`ISmtpService` для транзакционных, `IPromotionsSmtpService` для промо-рассылок).
    -   Использует `IEmailTemplatesService` для компиляции шаблонов писем.
-   **External Services**: Интеграции с внешними провайдерами (например, Unisender).

### Команды (Commands)
В данном модуле **не используется** паттерн Command.
Логика отправки реализована в сервисах.

## Для новых разработчиков

### Структура модуля
```
smtp/
├── email-templates-service/  # Сервисы для работы с шаблонами писем
├── external-services/        # Интеграции с внешними SMTP провайдерами
│   ├── unisender/              # Интеграция с Unisender
│   └── yandex-smtp/            # Интеграция с Yandex SMTP
├── api/                       # Presentation Layer (DTO)
├── infrastructure/            # Infrastructure Layer
└── index.ts                   # Экспорт модуля
```

### Основные потоки данных

1. **Отправка письма подтверждения регистрации**:
   - Модуль Account вызывает SmtpService для отправки письма
   - SmtpService компилирует шаблон письма с помощью HandlebarsTemplatesService
   - Письмо отправляется через Yandex SMTP или Unisender

2. **Отправка приглашения**:
   - Модуль Invites вызывает SmtpService для отправки приглашения
   - SmtpService компилирует шаблон приглашения
   - Письмо отправляется через внешний провайдер

### Интеграции с другими модулями

- **Account**: Для отправки писем подтверждения регистрации и восстановления пароля
- **Invites**: Для отправки приглашений
- **Events**: Для отправки уведомлений о мероприятиях

### Важные особенности

- Поддерживаются несколько провайдеров SMTP (Yandex, Unisender)
- Используется система шаблонов Handlebars для формирования писем
- Модуль использует Dependency Injection для подключения зависимостей
- Поддерживается отправка как транзакционных писем, так и промо-рассылок
- Для разработки доступна заглушка отправки писем (Stub services)
