# Assignments Module

## Описание
Модуль `Assignments` отвечает за управление связями между администраторами и участниками, а также назначениями (заданиями).

## Основные возможности
-   **Поиск администраторов**: Получение списка всех доступных администраторов.
-   **Управление назначениями**:
    -   Получение списка назначений для текущего пользователя (как для администратора, так и для участника).
    -   Просмотр деталей конкретного назначения.
    -   Обновление заметок к назначению.
    -   Создание новых назначений.

## Доменные сущности

### Assignment (Назначение)
Связь между администратором и участником. Определяет, какие участники привязаны к конкретному администратору.

**Поля:**
-   `id`: Уникальный идентификатор назначения.
-   `teacherId`: ID профиля администратора.
-   `studentId`: ID профиля участника.
-   `status`: Статус назначения (`requested`, `active`, `rejected`).
-   `notes`: Заметки администратора об участнике (массив строк).
-   `createdAt`: Дата создания назначения.
-   `student`: Обогащенные данные профиля участника (имя, фамилия, аватар) - загружается из `AccountsService`.
-   `teacher`: Обогащенные данные профиля администратора - загружается из `AccountsService`.

## API
Основные контроллеры:
-   `AssignmentsController` (`/api/v1`):
    -   `GET /teachers`: Получить список администраторов.
    -   `GET /assignments`: Получить список назначений.
    -   `GET /assignments/:assignmentId`: Получить детали назначения.
    -   `PUT /assignments/:id/notes`: Обновить заметки.

## Архитектура и реализация

### Основные компоненты
-   **AssignmentsService**: Сервис уровня приложения. Делегирует выполнение операций доменным сервисам и командам.
-   **Assignments (Domain Service)**: Класс, инкапсулирующий логику получения и обогащения назначений.
    -   Получает "сырые" данные из репозитория (`IAssignmentWithoutProfiles`).
    -   Обогащает их данными профилей (имя, аватар) через `AccountsService`.
-   **TeachersLookupService**: Сервис для поиска администраторов.
-   **CreateAssignmentCommand**: Команда для создания новых назначений.

### Взаимодействие с Accounts
Модуль `assignments` тесно связан с модулем `account`.
Назначение (`Assignment`) хранит только ID профилей (`studentId`, `teacherId`).
Для отображения информации (имя, фамилия) модуль запрашивает данные у `AccountsService`.

### Команды (Commands)
В модуле используется паттерн Command для операций изменения состояния:

#### `CreateAssignmentCommand`
Создает новую связь (назначение) между администратором и участником

### Репозиторий
**AssignmentsPrismaRepository** (`infrastructure/persistance`) реализует доступ к таблице `Assignment`.

## Для новых разработчиков

### Структура модуля
```
assignments/
├── api/                 # Presentation Layer (контроллеры, DTO)
├── model/              # Domain Layer (сущности, сервисы, интерфейсы)
│   ├── domain/          # Доменные объекты и команды
│   ├── services/        # Сервисы уровня приложения
│   └── interfaces/      # Интерфейсы для внешних зависимостей
└── infrastructure/       # Infrastructure Layer (реализации интерфейсов)
    ├── persistance/     # Реализации репозиториев
    └── services/       # Адаптеры для внешних сервисов
```

### Основные потоки данных
1. **Получение списка назначений**:
   - Контроллер получает запрос от клиента
   - Извлекает информацию о пользователе из токена
   - Вызывает соответствующий метод в `AssignmentsService`
   - Сервис определяет тип пользователя и вызывает нужный метод в доменном сервисе `Assignments`
   - Доменный сервис получает "сырые" данные из репозитория
   - Обогащает данные профилями через `AccountsService`
   - Возвращает результат в контроллер, который формирует ответ

2. **Создание назначения**:
   - Контроллер получает запрос на создание
   - Создает экземпляр `CreateAssignmentCommand`
   - Выполняет команду с нужными параметрами
   - Возвращает результат клиенту

### Важные особенности
- Все взаимодействия между модулями происходят через интерфейсы
- Модуль использует Dependency Injection для подключения зависимостей
- Для работы с базой данных используется Prisma ORM
- Все данные профилей загружаются через внешний сервис `AccountsService`
- Модуль экспортирует `AssignmentsService` для использования другими модулями
