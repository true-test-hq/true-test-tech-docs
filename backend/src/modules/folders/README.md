# Folders Module

## Описание
Модуль `Folders` отвечает за управление папками пользователей. Папки используются для организации материалов.

## Основные возможности
-   **Управление папками**:
    -   Создание, обновление, удаление папок.
    -   Получение списка папок пользователя.
    -   Специальный эндпоинт для бота.

## Доменные сущности

### Folder (Папка)
Папка для организации материалов. Принадлежит конкретному администратору.

**Поля:**
-   `id`: Уникальный идентификатор папки.
-   `ownerId`: ID профиля владельца (администратора).
-   `name`: Название папки.
-   `type`: Тип папки (`tasks`, `playlists`).
-   `materialsIds`: Список ID материалов, находящихся в папке.

## API
Основные контроллеры:
-   `FoldersController` (`/api/v1/folders`): CRUD операции для папок.
-   `UserFoldersController` (`/api/v1/me/folders`): Получение папок текущего пользователя.

## Архитектура и реализация

### Основные компоненты
-   **FoldersService**: Сервис уровня приложения. Управляет папками, делегируя операции командам.
-   **FolderAggregate**: Доменный агрегат. Содержит имя, тип папки и список ID материалов.
-   **IFoldersRepository**: Интерфейс для сохранения и загрузки папок.

### Команды (Commands)
Модуль использует паттерн Command для изменения состояния папок.
-   **`CreateFolderCommand`**: Создает новую папку для пользователя.
-   **`UpdateFolderCommand`**: Обновляет имя папки. Проверяет права доступа (владелец).
-   **`DeleteFolderCommand`**: Удаляет папку.
    -   **Важно**: При удалении папки материалы, находящиеся в ней, **не удаляются**, а перемещаются в "корневую" директорию (или теряют привязку к папке).
-   **`DeepCopyFolderCommand`**: Создает копию папки.
    -   Копирует саму папку.
    -   Вызывает `DeepCopyMaterialCommand` (из модуля `materials`) для каждого материала внутри папки, создавая их полные копии и помещая в новую папку.

## Для новых разработчиков

### Структура модуля
```
folders/
├── api/                 # Presentation Layer (контроллеры, DTO)
│   ├── folders.controller.ts
│   ├── index.ts
│   └── types.ts
├── infrastructure/     # Infrastructure Layer (реализации интерфейсов)
│   ├── persistence/
│   │   ├── folders.repository.ts
│   │   └── index.ts
│   ├── services/
│   │   ├── index.ts
│   │   └── materials.native.service.ts
│   └── index.ts
├── model/               # Domain Layer (сущности, сервисы, интерфейсы)
│   ├── domain/
│   ├── services/
│   │   ├── folders.service.ts
│   │   ├── for-invites.service.ts
│   │   └── index.ts
│   └── index.ts
└── index.ts             # Экспорт модуля
```

### Основные потоки данных

1. **Создание папки**:
   - Контроллер FoldersController получает запрос на создание папки
   - FoldersService создает экземпляр CreateFolderCommand
   - Команда валидирует данные и создает папку в репозитории

2. **Глубокое копирование папки**:
   - Контроллер FoldersController получает запрос на копирование папки
   - FoldersService создает экземпляр DeepCopyFolderCommand
   - Команда копирует папку и вызывает DeepCopyMaterialCommand для каждого материала

### Интеграции с другими модулями

- **Materials**: Для работы с материалами внутри папок
- **Accounts**: Для проверки прав доступа к папкам

### Важные особенности

- При удалении папки материалы не удаляются, а перемещаются в корневую директорию
- Поддерживается глубокое копирование папок с сохранением всех материалов
- Модуль использует Dependency Injection для подключения зависимостей
- Для работы с базой данных используется Prisma ORM
- Все изменения состояния папок происходят через команды
