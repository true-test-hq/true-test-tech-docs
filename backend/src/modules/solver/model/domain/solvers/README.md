# Solvers

## Описание
Директория `solvers` содержит логику проверки ответов пользователей и начисления баллов.
Здесь реализована валидация конкретных механик (типов вопросов).

## Основные компоненты

### `V1Solver`
Основная реализация решателя (`ISolver`).
Используется для проверки ответов на задачу.

#### Основные методы:
-   `tryFromAnswers`: Фабричный метод. Принимает ответы пользователя и правильные ответы (скрытый контент). Возвращает экземпляр `V1Solver` с результатами проверки.
-   `checkAnswer`: Проверяет один ответ пользователя против правильного.
-   `checkCorrectnessAndCalcPoints`: Делегирует проверку специфичным методам в зависимости от типа механики.

#### Поддерживаемые механики:
-   `common-fraction-mechanics`: Обыкновенные дроби.
-   `attachment-mechanics`: Вложения файлов.
-   `connector-mechanics`: Соединение элементов.
-   `selection-buttons-mechanics`: Выбор кнопок.
-   `input-mechanics` / `word-mechanics`: Ввод текста/слова.
-   `select-mechanics`: Выпадающий список.
-   `columns-sort-mechanics`: Сортировка по колонкам.
-   `list-sort-mechanics`: Сортировка списка.
-   `multiline-input-mechanics`: Многострочный ввод.

#### Backend Data
Функция также **обогащает** узлы графа служебными полями, необходимыми для работы `XStateLocator`:
-   `backendDataUID`: Уникальный идентификатор узла (UUID). Используется внутри FSM для однозначной идентификации, так как фронт не гарантирует уникальность `id` узлов.
-   `backendDataIsRoot`: Флаг (`true`), указывающий, что этот узел является стартовым.
-   `backendDataIsFinish`: Флаг (`true`), указывающий, что этот узел является конечным.
-   `backendDataTargets`: Массив идентификаторов (`backendDataUID`) целевых узлов.
-   `maxCoveredScore`: (Для `conditional`) Максимальный балл, покрываемый условиями.
-   `sortedSources`: (Для `conditional`) Отсортированный список переходов для проверки диапазонов.
-   `targetNodeId`: (Внутри условий) Ссылка на `backendDataUID` целевого узла.


### Хеширование ответов
Для оптимизации и поиска альтернативных правильных ответов используется хеширование (`hashAnswer`).
Ответы приводятся к каноническому виду (сортируются) и хешируются (SHA1).

### `AdditionalAnswers`
Система поддерживает "дополнительные ответы" (`additionalAnswers`). Если ответ пользователя не совпадает с основным правильным, он ищется в списке дополнительных правильных ответов по хешу.

## Для новых разработчиков

### Как добавить новую механику?
1.  Создать новый класс механики (например, `MyNewMechanic`) в `infrastructure/solvers/mechanics`.
2.  Реализовать интерфейс проверки (обычно это функция `check...`).
3.  Добавить вызов новой механики в `V1Solver.checkCorrectnessAndCalcPoints` (switch-case по типу задачи).
4.  Добавить тесты для новой механики.

### Процесс проверки
1.  `V1Solver` получает ответ пользователя и "скрытый контент" задачи (правильные ответы).
2.  Определяется тип механики.
3.  Вызывается специфичная логика проверки.
4.  Возвращается результат (`CheckResult`):
    -   `correctness`: Статус (`correct`, `incorrect`, `partially-correct`).
    -   `score`: Набранные баллы.
    -   `maxScore`: Максимальный балл за эту механику.
