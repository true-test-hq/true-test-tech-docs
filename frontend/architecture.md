# Архитектура проекта

## Содержание
1. [Общее описание](#общее-описание)
2. [Архитектурные слои и ответственность](#архитектурные-слои-и-ответственность)
3. [Структура папок](#структура-папок)
4. [Управление состоянием](#управление-состоянием)
5. [Маршрутизация](#маршрутизация)
6. [API и интеграции](#api-и-интеграции)
7. [Сборка и развертывание](#сборка-и-развертывание)
8. [Поток данных](#поток-данных)
9. [Архитектурные принципы](#архитектурные-принципы)
10. [Ограничения](#ограничения)

## Общее описание

В качестве сборщика используется Vite. Приложение следует модульной архитектуре с четким разделением ответственности между слоями.

Основные технологии:
- React 18
- TypeScript
- Vite (сборка)
- React Router v6 (маршрутизация)
- React Query (управление серверным состоянием)
- Effector (управление клиентским состоянием, deprecated)
- Storybook (документация компонентов)

## Архитектурные слои и ответственность

### UI слой (`src/shared/composite-ui/`, `src/shared/ui/`)
Содержит переиспользуемые UI компоненты низкого уровня, такие как кнопки, инпуты, модалки и т.д.

### Компоненты (`src/widgets/`)
Бизнес-компоненты, которые объединяют несколько UI компонентов и содержат логику отображения. Примеры: `material-preview-widget`, `solver-widget`.

### Страницы (`src/pages/`)
Компоненты страниц, которые объединяют виджеты и модули для формирования полноценных страниц приложения.

### Состояние (`src/modules/*/model/`, `src/shared/stores/`)
Управление состоянием приложения. Используется React Query для серверного состояния и Effector для клиентского (deprecated).

### Сервисы/API (`src/shared/api/`)
Слой интеграции с внешними API. Каждый API представлен отдельным классом с методами для работы с конкретной сущностью.

### Доменная логика (`src/modules/*/model/`)
Бизнес-логика приложения, валидации, преобразования данных.

### Утилиты (`src/shared/utils/`, `src/shared/services/`)
Вспомогательные функции и сервисы, используемые по всему приложению.

### Инфраструктура (`src/app/`)
Базовая инфраструктура приложения: роутинг, обработка ошибок, настройка i18n, Sentry и т.д.

## Структура папок

```
.
├── .github/workflows/          # CI/CD конфигурации
├── .storybook/                 # Конфигурация Storybook
├── src/                        # Исходный код приложения
│   ├── app/                    # Инфраструктурный слой приложения
│   │   ├── App.tsx             # Корневой компонент
│   │   ├── constants/          # Глобальные константы
│   │   ├── processes/          # Глобальные процессы
│   │   ├── router/             # Конфигурация маршрутов
│   │   └── ...
│   ├── modules/                # Бизнес-модули
│   │   ├── analytics/          # Модуль аналитики
│   │   ├── assignments/        # Модуль заданий
│   │   ├── events/             # Модуль событий
│   │   ├── materials/          # Модуль материалов
│   │   ├── overview/          # Модуль обзора
│   │   └── ...
│   ├── pages/                  # Страницы приложения
│   │   ├── admin-office-page/  # Страница админки
│   │   ├── solver/             # Страницы решателя
│   │   └── ...
│   ├── shared/                 # Общие компоненты и утилиты
│   │   ├── api/                # API клиенты
│   │   ├── composite-ui/      # Сложные UI компоненты
│   │   ├── ui/                 # Простые UI компоненты
│   │   ├── utils/              # Утилиты
│   │   └── ...
│   ├── widgets/                # Бизнес-виджеты
│   │   ├── solver-widget/    # Виджет решателя
│   │   └── ...
│   └── index.tsx               # Точка входа
└── package.json               # Зависимости и скрипты
```

## Управление состоянием

Приложение использует гибридный подход к управлению состоянием:

### Серверное состояние
- **React Query** - для управления серверным состоянием
- Хуки расположены в `src/modules/*/model/hooks/`
- Пример: `useOverviewListAsync`, `useAnalyticsSolvabilityAsync`

### Клиентское состояние
- **Effector** - для управления клиентским состоянием
- Хранилища расположены в `src/shared/stores/`, deprecated

### API слой
- Классы API расположены в `src/shared/api/`
- Каждый API представляет собой класс с методами для работы с конкретной сущностью
- Примеры: `MaterialsApi`, `EventsApi`, `SolverApi`

## Маршрутизация

Используется React Router v6. Маршруты определяются в `src/app/router/Router.tsx`.

### Структура маршрутов
- **Публичные маршруты** - доступны без авторизации
- **Приватные маршруты** - доступны только авторизованным пользователям
- **Ролевые маршруты** - доступны пользователям с определенной ролью (Admin, Participant)

### Основные группы маршрутов
1. `/solver/*` - Решатор (публичный и внутренний)
2. `/admin/office/*` - Админка
3. `/participant/*` - Кабинет участника
4. `/auth/*` - Авторизация
5. `/system/*` - Системные страницы

## API и интеграции

### Основные API сервисы
- **Auth** - Авторизация (`@react-oauth/google`)
- **Analytics** - Аналитика (`src/modules/analytics/`)
- **Error Tracking** - Sentry (`@sentry/react`)
- **API Client** - Axios для HTTP запросов (`src/shared/api/Request.ts`)

### Структура API
Каждый API представлен отдельным классом в `src/shared/api/`:
- `AuthApi` - авторизация
- `MaterialsApi` - материалы
- `EventsApi` - события
- `SolverApi` - решатор
- `OverviewApi` - обзор
- `AnalyticsApi` - аналитика

## Сборка и развертывание

### Основные команды
- **Разработка**: `yarn start`
- **Сборка**: `yarn build`
- **Storybook**: `yarn storybook`
- **Линтинг**: `yarn lint`
- **Форматирование**: `yarn format`

### CI/CD процессы
Расположены в `.github/workflows/`:
- `build.yml` - сборка и тестирование
- `deploy-prod.yml` - развертывание в продакшн
- `deploy-test.yml` - развертывание в тестовое окружение
- `publish-storybook.yml` - публикация Storybook

## Поток данных

```text
Компонент → Хук → Запрос/Мутация → API Сервис → Бэкенд
                 (React Query)     (src/shared/api/)
```

```mermaid
flowchart LR
    Component[Компонент] --> Hook[Хук]
    Hook --> Query[Запрос/Мутация]
    Query --> API[API Сервис]
    API --> Backend[Бэкенд]
```

## Ограничения

- Node.js >= 22
- Yarn >= 1.22
- TypeScript в strict режиме
- ESLint и Prettier для контроля качества кода
- Строгая типизация во всем проекте